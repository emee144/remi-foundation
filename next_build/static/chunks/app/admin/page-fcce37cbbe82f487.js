(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{775:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),n=a(8661),c=a(2115),l=a(1733),i=a(6497),r=a(5239);function o(){let[e,t]=(0,c.useState)(""),[a,o]=(0,c.useState)(!1),[d,b]=(0,c.useState)(""),[h,x]=(0,c.useState)(""),[m,p]=(0,c.useState)([]),[f,u]=(0,c.useState)([]),[g,j]=(0,c.useState)(!1),[y,w]=(0,c.useState)(""),N=async()=>{j(!0);try{let e=await fetch("/api/admin/users"),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to fetch users");u(t.users||[]),p(t.users||[])}catch(e){w(e.message)}finally{j(!1)}};(0,c.useEffect)(()=>{a&&N()},[a]);let v=async()=>{if(!h.trim())return void p(f);j(!0),w("");try{let e=await fetch("/api/admin/users?search=".concat(encodeURIComponent(h))),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to fetch users");p(t.users||[])}catch(e){w(e.message)}finally{j(!1)}},C=async e=>{try{let t=await fetch("/api/admin/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to create purchase");let s=new Date().toISOString();localStorage.setItem("purchaseDate_".concat(e),s),alert("Purchase created successfully!"),N()}catch(e){alert(e.message)}};(0,c.useEffect)(()=>{let e=setInterval(()=>p(e=>[...e]),6e4);return()=>clearInterval(e)},[]);let k={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},S={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.4}},hover:{scale:1.02}};return a?(0,s.jsxs)("div",{className:"jsx-43ca2cfb9deebb81 min-h-screen bg-gray-50 p-8",children:[(0,s.jsxs)("div",{className:"jsx-43ca2cfb9deebb81 flex justify-between items-start mb-6",children:[(0,s.jsxs)("div",{className:"jsx-43ca2cfb9deebb81 flex flex-col items-center",children:[(0,s.jsx)(r.default,{src:"/remilogo.jpeg",alt:"Remi Logo",width:120,height:120,className:"mb-4"}),(0,s.jsx)(l.P.h1,{className:"text-4xl font-bold text-yellow-600 mb-2 text-center",initial:"hidden",animate:"visible",variants:k,children:"Remi Oseni Foundation"})]}),(0,s.jsx)("button",{onClick:()=>{o(!1),t("")},className:"jsx-43ca2cfb9deebb81 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold mt-4",children:"Logout"})]}),(0,s.jsxs)(l.P.div,{className:"flex flex-col md:flex-row gap-4 mb-6 justify-center",initial:"hidden",animate:"visible",variants:k,children:[(0,s.jsx)("input",{type:"text",placeholder:"Search by NIN, phone, or email",value:h,onChange:e=>x(e.target.value),className:"jsx-43ca2cfb9deebb81 flex-1 p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"}),(0,s.jsx)("button",{onClick:v,className:"jsx-43ca2cfb9deebb81 bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 transition font-bold",children:"Search"})]}),g&&(0,s.jsx)("p",{className:"jsx-43ca2cfb9deebb81 text-gray-600 text-center",children:"Loading..."}),y&&(0,s.jsx)("p",{className:"jsx-43ca2cfb9deebb81 text-red-500 text-center",children:y}),(0,s.jsx)(i.N,{children:m.length>0&&(0,s.jsx)(l.P.div,{className:"overflow-x-auto mt-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsxs)("table",{className:"jsx-43ca2cfb9deebb81 min-w-full bg-white shadow-lg rounded-2xl overflow-hidden",children:[(0,s.jsx)("thead",{className:"jsx-43ca2cfb9deebb81 bg-yellow-500 text-white",children:(0,s.jsxs)("tr",{className:"jsx-43ca2cfb9deebb81",children:[(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"QR Code"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"NIN"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"Name"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"Phone"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"Email"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"Gender"}),(0,s.jsx)("th",{className:"jsx-43ca2cfb9deebb81 p-3 text-left",children:"Purchase"})]})}),(0,s.jsx)("tbody",{className:"jsx-43ca2cfb9deebb81",children:m.map((e,t)=>{let a=e.purchases.length>0?e.purchases[e.purchases.length-1]:null,n=a?((e,t)=>{let a,s=new Date,n=localStorage.getItem("purchaseDate_".concat(t));if(n)a=new Date(n);else{if(!e)return 0;a=new Date(e),localStorage.setItem("purchaseDate_".concat(t),a.toISOString())}return Math.max(30-Math.floor((s-a)/864e5),0)})(a.purchaseDate,e.id):0,c=0===n;return(0,s.jsxs)(l.P.tr,{className:"border-b hover:bg-yellow-50 transition ".concat(t%2==0?"bg-gray-50":""),variants:S,initial:"hidden",animate:"visible",whileHover:"hover",children:[(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:e.qrCode?(0,s.jsxs)("div",{className:"jsx-43ca2cfb9deebb81 flex flex-col items-center gap-2",children:[(0,s.jsx)(r.default,{src:e.qrCode.startsWith("data:image")?e.qrCode:"data:image/png;base64,".concat(e.qrCode),alt:"QR Code",width:240,height:240,unoptimized:!0,className:"rounded-lg shadow-lg object-contain"}),(0,s.jsxs)("div",{className:"jsx-43ca2cfb9deebb81 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>((e,t)=>{let a=document.createElement("a");a.href="data:image/png;base64,".concat(e),a.download="QR_".concat(t,".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a)})(e.qrCode,e.nin),className:"jsx-43ca2cfb9deebb81 bg-green-500 hover:bg-green-600 text-white text-xs py-1 px-2 rounded",children:"Download"}),(0,s.jsx)("button",{onClick:()=>(e=>{let t=window.open("","_blank","width=800,height=600");t.document.write('\n      <html>\n        <head>\n          <title>Print QR</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              height: 100vh;\n              margin: 0;\n            }\n            .container {\n              text-align: center;\n              page-break-inside: avoid;\n            }\n            p, h1 { margin: 5px 0; }\n          </style>\n        </head>\n        <body>\n          <div class="container">\n            <h1>Remi Oseni Foundation</h1>\n            <img src="'.concat(e.qrCode.startsWith("data:image")?e.qrCode:"data:image/png;base64,".concat(e.qrCode),'" \n                 alt="QR Code" width="200" height="200" style="display:block; margin: 0 auto 20px auto;" />\n            <p><strong>NIN:</strong> ').concat(e.nin,"</p>\n            <p><strong>Name:</strong> ").concat(e.surname," ").concat(e.otherNames,"</p>\n            <p><strong>Phone:</strong> ").concat(e.phone,"</p>\n            <p><strong>Email:</strong> ").concat(e.email,"</p>\n            <p><strong>Gender:</strong> ").concat(e.gender,"</p>\n          </div>\n        </body>\n      </html>\n    ")),t.document.close(),t.focus(),t.print(),t.close()})(e),className:"jsx-43ca2cfb9deebb81 bg-blue-500 hover:bg-blue-600 text-white text-xs py-1 px-2 rounded",children:"Print"})]})]}):(0,s.jsx)("span",{className:"jsx-43ca2cfb9deebb81 text-gray-400",children:"No QR"})}),(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:e.nin}),(0,s.jsxs)("td",{className:"jsx-43ca2cfb9deebb81 p-3 font-semibold",children:[e.surname," ",e.otherNames]}),(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:e.phone}),(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:e.email}),(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:e.gender}),(0,s.jsx)("td",{className:"jsx-43ca2cfb9deebb81 p-3",children:a?(0,s.jsxs)("span",{className:"jsx-43ca2cfb9deebb81 text-sm font-semibold",children:[n," day(s) left"]}):(0,s.jsx)("button",{onClick:()=>C(e.id),disabled:!c,className:"jsx-43ca2cfb9deebb81 "+"bg-yellow-500 text-white px-3 py-1 rounded font-bold hover:bg-yellow-600 transition ".concat(c?"":"opacity-50 cursor-not-allowed"),children:"Purchase"})})]},e.id)})})]})})}),0===m.length&&!g&&(0,s.jsx)("p",{className:"jsx-43ca2cfb9deebb81 text-gray-500 text-center mt-8 text-lg",children:"No users found."}),(0,s.jsx)(n,{id:"43ca2cfb9deebb81",children:"@media print{img{display:block!important;width:240px!important;height:240px!important}body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}"})]}):(0,s.jsx)("div",{className:"min-h-screen flex flex-col justify-center items-center bg-gradient-to-r from-yellow-50 via-green-50 to-yellow-100 px-4",children:(0,s.jsxs)(l.P.div,{className:"bg-white p-10 rounded-3xl shadow-xl w-full max-w-md text-center",initial:"hidden",animate:"visible",variants:k,children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6 text-yellow-600",children:"Admin Login"}),d&&(0,s.jsx)("p",{className:"text-red-500 mb-4",children:d}),(0,s.jsx)("input",{type:"password",placeholder:"Enter admin password",value:e,onChange:e=>t(e.target.value),className:"w-full p-4 border rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-yellow-500"}),(0,s.jsx)("button",{onClick:()=>{"Kokoletmi901"===e?(o(!0),b("")):b("Incorrect password")},className:"w-full bg-yellow-500 text-white py-3 rounded-lg font-bold hover:bg-yellow-600 transition",children:"Login"})]})})}},2865:(e,t,a)=>{Promise.resolve().then(a.bind(a,775))}},e=>{e.O(0,[356,855,325,441,493,358],()=>e(e.s=2865)),_N_E=e.O()}]);